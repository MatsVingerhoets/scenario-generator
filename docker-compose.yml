version: "3.9"
services:
  app:
    working_dir: /${APP_DIR}
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - ${APP_PORT}:3003
    volumes:
      - .:/${APP_DIR}:cached
      - ~/.ssh:/root/.ssh:ro
      # Host dotfiles
      - ${ZSHRC_PATH:-${HOME}/.zshrc}:/root/.zshrc:ro
      - ${NEOVIM_CONFIG_PATH:-${HOME}/.config/nvim}:/root/.config/nvim
      - ${GITCONFIG_PATH:-${HOME}/.gitconfig}:/root/.gitconfig:ro
      - ${CODEX_PATH:-/dev/null}:/root/.codex
      # Persist Neovim data/cache/state so plugins are not reinstalled each time
      - nvim-data:/root/.local/share/nvim
      - nvim-state:/root/.local/state/nvim
      - nvim-cache:/root/.cache/nvim
    stdin_open: true
    tty: true
    command: zsh
    env_file:
      - .env
volumes:
  nvim-data: null
  nvim-state: null
  nvim-cache: null
networks: {}
